name: 🔁 Update Random Quote

on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:      # Allow manual trigger

jobs:
  update-readme:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v3

      - name: Fetch Random Quote
        run: |
          response=$(curl -s https://random-quotes-freeapi.vercel.app/api/random)
          quote=$(echo "$response" | jq -r '.quote')
          author=$(echo "$response" | jq -r '.author')
          echo "> _\"$quote\"_" > quote.txt
          echo "> **— $author**" >> quote.txt

      - name: Update README
        run: |
          start="<!--QUOTE_START-->"
          end="<!--QUOTE_END-->"
          quote_content=$(cat quote.txt)
          awk -v s="$start" -v e="$end" -v q="$quote_content" '
            BEGIN {print_line=1}
            $0 ~ s {print; print q; print_line=0; next}
            $0 ~ e {print_line=1}
            print_line {print}
          ' README.md > new_README.md
          mv new_README.md README.md

      - name: Commit and Push
        run: |
          git config --global user.name 'github-actions'
          git config --global user.email 'github-actions@github.com'
          git add README.md
          git commit -m "🔄 update quote"
          git push
